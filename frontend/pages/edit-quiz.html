<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>QuizTrek | Edit Quiz</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styleQuizzes.css') }}">
    <script defer src="{{ url_for('static', filename='javascripts/editQuiz.js') }}" defer></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styleHome.css') }}">
    <script src="{{ url_for('static', filename='javascripts/sidebarFunctions.js') }}" defer></script>
</head>
<body>
    <!-- Navigation Sidebar Menu, credits: Coding2GO-->
    <nav id="sidebar">
        <ul>
            <li>
                <span class="logo">               
                    <a href="{{ url_for('home') }}">
                        <img src="{{ url_for('static', filename='images/quizTrekLogo.png') }}" height="100" width="100" alt="QuizTrek Logo" />
                    </a>
                </span>
                <button onclick=toggleSidebar() id="toggle-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#B7B7B7"><path d="M440-240 200-480l240-240 56 56-183 184 183 184-56 56Zm264 0L464-480l240-240 56 56-183 184 183 184-56 56Z"/></svg>
                </button>
            </li>  
            <li class="active"> 
                <a href="{{ url_for('explore.explore_page') }}">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#B7B7B7"><path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/></svg>
                    <span>Explore</span>
                </a>
            </li> 
            <li>
                <button onclick=toggleSubMenu(this) class="dropdown-btn">   
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#B7B7B7"><path d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h240v80H200v560h560v-240h80v240q0 33-23.5 56.5T760-120H200Zm440-400v-120H520v-80h120v-120h80v120h120v80H720v120h-80Z"/></svg>
                    <span>Create</span>
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#B7B7B7"><path d="M480-360 280-560h400L480-360Z"/></svg>
                </button>
                <ul class="sub-menu">
                    <div>
                        <li>
                            <a href="{{ url_for('quiz.create_quiz_page') }}">
                                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#B7B7B7"><path d="M560-360q17 0 29.5-12.5T602-402q0-17-12.5-29.5T560-444q-17 0-29.5 12.5T518-402q0 17 12.5 29.5T560-360Zm-30-128h60q0-29 6-42.5t28-35.5q30-30 40-48.5t10-43.5q0-45-31.5-73.5T560-760q-41 0-71.5 23T446-676l54 22q9-25 24.5-37.5T560-704q24 0 39 13.5t15 36.5q0 14-8 26.5T578-596q-33 29-40.5 45.5T530-488ZM320-240q-33 0-56.5-23.5T240-320v-480q0-33 23.5-56.5T320-880h480q33 0 56.5 23.5T880-800v480q0 33-23.5 56.5T800-240H320Zm0-80h480v-480H320v480ZM160-80q-33 0-56.5-23.5T80-160v-560h80v560h560v80H160Zm160-720v480-480Z"/></svg>
                                <span>Quiz</span>           
                            </a>
                        </li>
                    </div>
                </ul>
            </li>
            <li class="active">
                <a href="{{ url_for('home') }}#'contact'page">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#B7B7B7"><path d="M120-160v-640l760 320-760 320Zm80-120 474-200-474-200v140l240 60-240 60v140Zm0 0v-400 400Z"/></svg>
                    <span>Contact</span>
                </a>
            </li>
            <li>
                <button onclick=toggleSubMenu(this) class="dropdown-btn">   
                    <img src="{{ url_for('static', filename='icons/user.png') }}" height = "24" width = "24" />
                    <span>Profile</span>
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#B7B7B7"><path d="M480-360 280-560h400L480-360Z"/></svg>
                </button>
                <ul class="sub-menu">
                    <div>
                        <li>
                            <a href="{{ url_for('user_profile.profile') }}">
                                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#B7B7B7"><path d="M520-600v-240h320v240H520ZM120-440v-400h320v400H120Zm400 320v-400h320v400H520Zm-400 0v-240h320v240H120Zm80-400h160v-240H200v240Zm400 320h160v-240H600v240Zm0-480h160v-80H600v80ZM200-200h160v-80H200v80Zm160-320Zm240-160Zm0 240ZM360-280Z"/></svg>
                                <span>Your Quizzes</span>
                            </a>
                        </li>
                        <li>
                            <a href="{{ url_for('home') }}#settings">
                                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#B7B7B7"><path d="m370-80-16-128q-13-5-24.5-12T307-235l-119 50L78-375l103-78q-1-7-1-13.5v-27q0-6.5 1-13.5L78-585l110-190 119 50q11-8 23-15t24-12l16-128h220l16 128q13 5 24.5 12t22.5 15l119-50 110 190-103 78q1 7 1 13.5v27q0 6.5-2 13.5l103 78-110 190-118-50q-11 8-23 15t-24 12L590-80H370Zm70-80h79l14-106q31-8 57.5-23.5T639-327l99 41 39-68-86-65q5-14 7-29.5t2-31.5q0-16-2-31.5t-7-29.5l86-65-39-68-99 42q-22-23-48.5-38.5T533-694l-13-106h-79l-14 106q-31 8-57.5 23.5T321-633l-99-41-39 68 86 64q-5 15-7 30t-2 32q0 16 2 31t7 30l-86 65 39 68 99-42q22 23 48.5 38.5T427-266l13 106Zm42-180q58 0 99-41t41-99q0-58-41-99t-99-41q-59 0-99.5 41T342-480q0 58 40.5 99t99.5 41Zm-2-140Z"/></svg>
                                <span>Settings</span>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0)" onclick="toggleLogoutButton(this)">
                                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#B7B7B7"><path d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h280v80H200v560h280v80H200Zm440-160-55-58 102-102H360v-80h327L585-622l55-58 200 200-200 200Z"/></svg>
                                <span>Sign Out</span>
                            </a>
                        </li>
                    </div>
                </ul>
            </li>
        </ul>
    </nav>
    <main>
        <div class="quiz-container">
            <h2>Edit Quiz</h2>

            <form id="quiz-form" method="POST" enctype="multipart/form-data">
            <div class="form-exterior">
                <label for="title">
                    Quiz Title:
                    <input type="text" id="title" name="title" value="{{ quiz.title }}" required>
                </label>
            </div>

            <div id="questions-container">
                {% for q in quiz.questions %}
                {% set i = loop.index0 %}
                <div class="question-block">
                    <label>Question {{ loop.index }}:</label>
                    <input type="text" name="questions[{{ i }}][text]" value="{{ q.text }}" required>

                    <label>Select Type:</label>
                    <select name="questions[{{ i }}][type]" onchange="handleTypeChange(this, '{{ i }}')">
                        <option value="mcq" {% if q.type == 'mcq' %}selected{% endif %}>Multiple Choice</option>
                        <option value="truefalse" {% if q.type == 'truefalse' %}selected{% endif %}>True/False</option>
                        <option value="shortanswer" {% if q.type == 'shortanswer' %}selected{% endif %}>Short Answer</option>
                    </select>

                    <div class="options" id="options-{{ i }}">
                    {% if q.type == "mcq" %}
                        <label>Upload Image (Optional):</label>
                        {% if q.image %}
                            <div class="image-preview">
                                <img src="{{ url_for('static', filename=q.image) }}" alt="Question Image" height="100">
                            </div>
                        {% else %}
                            <div class="image-preview" style="display:none;"></div>
                        {% endif %}
                        <input type="file" name="questions[{{ i }}][image]" onchange="previewImage(event, this)">
                        <label>Options:</label>
                        {% for opt in q.options %}
                        <input type="text" name="questions[{{ i }}][options][]" value="{{ opt }}" required>
                        {% endfor %}
                        <label>Correct Option (A/B/C/D):</label>
                        <input type="text" name="questions[{{ i }}][answer]"
                        value="{% for opt in q.options %}{% if opt == q.answer %}{{ 'ABCD'[loop.index0] }}{% endif %}{% endfor %}"
                        required>
                    {% elif q.type == "truefalse" %}
                        <label>Answer:</label>
                        <select name="questions[{{ i }}][answer]">
                        <option value="true" {% if q.answer == 'true' %}selected{% endif %}>True</option>
                        <option value="false" {% if q.answer == 'false' %}selected{% endif %}>False</option>
                        </select>
                    {% elif q.type == "shortanswer" %}
                        <label>Upload Image (Optional):</label>
                        {% if q.image %}
                            <div class="image-preview">
                                <img src="{{ url_for('static', filename=q.image) }}" alt="Question Image" height="100">
                            </div>
                        {% else %}
                            <div class="image-preview" style="display:none;"></div>
                        {% endif %}
                        <input type="file" name="questions[{{ i }}][image]" onchange="previewImage(event, this)">
                        <label>Answer:</label>
                        <input type="text" name="questions[{{ i }}][answer]" value="{{ q.answer }}" required>
                    {% endif %}
                    </div>

                    <div class="delete-button">
                        <button type="button" onclick="deleteQuestion(this)">Delete Question</button>
                    </div>
                </div>
                {% endfor %}
            </div>

            <div class="button-container">
                <button type="button" onclick="addEditQuestion()">+ Add Question</button>
                <button type="submit">Update Quiz</button>
            </div>

            <div class="form-exterior">
                <label>
                <input type="checkbox" name="add_whiteboard" value="true" {% if quiz.add_whiteboard %}checked{% endif %}>
                Add Digital Whiteboard
                </label>
            </div>
            </form>
            <div class="form-exterior">
                <a href="{{ url_for('user_profile.profile') }}">
                    <button>Back to Your Quizzes</button>
                </a>
            </div>
        </div>
        <!-- Footer Section -->
        <footer>
            <p>&copy; 2025 QuizTrek. All rights reserved.</p>
        </footer>
    </main>
</body>
</html>